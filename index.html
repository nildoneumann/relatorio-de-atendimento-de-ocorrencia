<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Relatório de Atendimento de Ocorrência</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon-192.png">
  <meta name="theme-color" content="#ffffff">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 15px;
      font-size: 16px;
      font-weight: bold;
      max-width: 900px;
      margin: auto;
      color: #084808;
    }
    h1 {
      text-align: center;
      font-size: 22px;
      margin-top: 1px;
      color: blue;
    }
    .logo-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1px;
    }
    .logo {
      width: 80px;
    }
    .linha-horizontal, .linha-horizontal-2, .linha-horizontal-3 {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      margin-top: 3px;
    }
    .linha-horizontal label, .linha-horizontal-2 label, .linha-horizontal-3 label {
      flex: 1;
      min-width: 180px;
    }
    label {
      display: block;
      margin-top: 4px;
    }
    input[type="date"], input[type="time"] {
      width: 80%;
      padding: 5px;
      font-weight: bold;
      font-size: 15px;
      color: blue;
    }
    input[type="text"] {
      width: 90%;
      padding: 5px;
      font-weight: bold;
      font-size: 14px;
      color: blue;
    }
    textarea {
      width: 95%;
      padding: 5px;
      font-weight: bold;
      font-size: 14px;
      height: 80px;
      color: blue;
    }
    .btn {
      margin-top: 20px;
      padding: 10px 15px;
      font-weight: bold;
      font-size: 20px;
      background-color: #93BF85;
      color: blue;
      border: none;
      cursor: pointer;
      border-radius: 8px; /* Cantos arredondados */
    }
    p {
      color: red;
      margin-top: 8px;
      font-size: 13px;
      background-color: yellow;
    }
    #pdf-content {
      background-color: #D6FFFF;
      padding: 20px;
    }
    .neumann {
      font-size: 10px;
      color: black;
    }
  </style>
</head>
<body>
<label for="nome" style="font-size: 5px;">© 2025 Leonildo.Neumann</label>
<div class="logo-container">
  <img src="logo-prefeitura.png" alt="Prefeitura" class="logo">
  <label for="nome" style="font-size: 26px;">SETRAN GUARAPUAVA</label>
  <img src="logo-setran.png" alt="Setran" class="logo">
</div>

<div id="pdf-content">

  <h1><u>RELATÓRIO DE ATENDIMENTO DE OCORRÊNCIA</u></h1>

  <label>1 - NÚMERO: <input type="text" name="numero" style="width: 50px;"> /2025</label>

  <div class="linha-horizontal">
    <label>Data: <input type="date" name="data"></label>
    <label>Hora Início: <input type="time" name="hora_inicio"></label>
    <label>Hora Término: <input type="time" name="hora_termino"></label>
  </div>
<div class="linha-horizontal">
  <label>2 - SOLICITANTE: <input type="text" name="solicitante"></label>
  <label>NÚMERO DO TELEFONE: <input type="text" name="telefone"></label>
</div>
  <label>LOCAL DA OCORRÊNCIA: <input type="text" name="local"></label>
  <label>SITUAÇÃO INFORMADA: <textarea name="situacao"></textarea></label>

  <label>3 - RELATÓRIO DO ATENDIMENTO E AÇÕES REALIZADAS: <textarea name="relatorio"></textarea></label>

  <label>- Autos de infração lavrados: <input type="text" name="autos"></label>
  <label>- Número de pessoas atendidas: <input type="text" name="pessoas_atendidas"></label>
  <label>- Veículos recolhidos: <input type="text" name="veiculos"></label>

  <label>4 - EQUIPE:</label>
<label>VTR(s): <input type="text" name="vtr"></label>

  <div class="linha-horizontal-3">
    <label>Nome Agente 1: <input type="text" name="assinatura1"></label>
    <label>Nome Agente 2: <input type="text" name="assinatura2"></label>
  </div>
<div class="linha-horizontal-2">
<label><input type="checkbox" onclick="toggleAgente('agente1')"> Incluir Ass. Agente 1</label>
<label><input type="checkbox" onclick="toggleAgente('agente2')"> Incluir Ass. Agente 2</label>
</div>
 <div class="linha-horizontal-2"> 
<div id="agente1" class="section" style="display:none;"> 
  <canvas id="assinaturaAgente1" width="415" height="70" style="border:1px solid #000; background:#fff;"></canvas><br>
  <button type="button" onclick="limparAssinatura(assinaturaAgente1Pad)">Limpar Assinatura</button>
</div>
<div id="agente2" class="section" style="display:none;">
 <canvas id="assinaturaAgente2" width="415" height="70" style="border:1px solid #000; background:#fff;"></canvas><br>
  <button type="button" onclick="limparAssinatura(assinaturaAgente2Pad)">Limpar Assinatura</button>
</div>
</div>



<div class="linha-horizontal-3">
    <label>Nome Agente 3: <input type="text" name="assinatura3"></label>
    <label>Nome Agente 4: <input type="text" name="assinatura4"></label>
  </div>
<div class="linha-horizontal-2">
<label><input type="checkbox" onclick="toggleAgente('agente3')"> Incluir Ass. Agente 3</label>
<label><input type="checkbox" onclick="toggleAgente('agente4')"> Incluir Ass. Agente 4</label>
</div>

<div class="linha-horizontal-2">
<div id="agente3" class="section" style="display:none;">
  <canvas id="assinaturaAgente3" width="415" height="70" style="border:1px solid #000; background:#fff;"></canvas><br>
  <button type="button" onclick="limparAssinatura(assinaturaAgente3Pad)">Limpar Assinatura</button>
</div>
<div id="agente4" class="section" style="display:none;">
  <canvas id="assinaturaAgente4" width="415" height="70" style="border:1px solid #000; background:#fff;"></canvas><br>
  <button type="button" onclick="limparAssinatura(assinaturaAgente4Pad)">Limpar Assinatura</button>
</div>
</div>

<p><strong>OBS:</strong> Este documento é uma coleta preliminar de dados,para controle de atendimentos de ACIDENTES/OCORRÊNCIA da SETRAN,e não substitui o registro realizado por outros órgãos.</p>

  <div class="neumann">
   <div style="position: relative;">
   <label for="meuInput" style="position: absolute; right: 0;">© 2025 Leonildo.Neumann</label>
  </div>
</div>
</div>

<img id="assinaturaAgente1Img" style="display:none;">
<img id="assinaturaAgente2Img" style="display:none;">
<img id="assinaturaAgente3Img" style="display:none;">
<img id="assinaturaAgente4Img" style="display:none;">


<button type="button" class="btn" onclick="imprimir()">Imprimir</button>
<button type="button" class="btn" onclick="gerarPDF()">Baixar PDF</button>
<button type="button" class="btn" onclick="compartilharPDF()">Compartilhar PDF</button>

<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.6/dist/signature_pad.umd.min.js"></script>
<script>
  const assinaturaAgente1Pad = new SignaturePad(document.getElementById('assinaturaAgente1'));
  const assinaturaAgente2Pad = new SignaturePad(document.getElementById('assinaturaAgente2'));
  const assinaturaAgente3Pad = new SignaturePad(document.getElementById('assinaturaAgente3'));
  const assinaturaAgente4Pad = new SignaturePad(document.getElementById('assinaturaAgente4'));

  function toggleAgente(id) {
    const div = document.getElementById(id);
    div.style.display = div.style.display === 'none' ? 'block' : 'none';
  }

  function limparAssinatura(pad) {
    pad.clear();
  }

  function bloquearScrollDuranteDesenho(pad) {
    const canvas = pad.canvas;
    canvas.addEventListener('touchstart', function (e) { e.preventDefault(); }, { passive: false });
    canvas.addEventListener('touchmove', function (e) { e.preventDefault(); }, { passive: false });
  }

  bloquearScrollDuranteDesenho(assinaturaAgente1Pad);
  bloquearScrollDuranteDesenho(assinaturaAgente2Pad);
  bloquearScrollDuranteDesenho(assinaturaAgente3Pad);
  bloquearScrollDuranteDesenho(assinaturaAgente4Pad);

  function capturarAssinaturas() {
    document.getElementById('assinaturaAgente1Img').src = assinaturaAgente1Pad.isEmpty() ? '' : assinaturaAgente1Pad.toDataURL();
    document.getElementById('assinaturaAgente2Img').src = assinaturaAgente2Pad.isEmpty() ? '' : assinaturaAgente2Pad.toDataURL();
    document.getElementById('assinaturaAgente3Img').src = assinaturaAgente3Pad.isEmpty() ? '' : assinaturaAgente3Pad.toDataURL();
    document.getElementById('assinaturaAgente4Img').src = assinaturaAgente4Pad.isEmpty() ? '' : assinaturaAgente4Pad.toDataURL();
  }
function imprimir() {
  window.print();
}


  function gerarPDF() {
    capturarAssinaturas();
    const element = document.getElementById('pdf-content');
    html2pdf()
      .set({
        margin: [5, 5, 5, 5],
        filename: 'relatorio_ocorrencia.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true, scrollY: 0 },
        jsPDF: { unit: 'mm', format: 'a3', orientation: 'portrait' }
      })
      .from(element)
      .save();
  }
async function compartilharPDF() {
    capturarAssinaturas();

    const element = document.getElementById('pdf-content');
    const opt = {
      margin: 0.5,
      filename: 'relatorio_ocorrencia.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
    };

    const pdfBlob = await html2pdf().set(opt).from(element).outputPdf('blob');

    if (navigator.canShare && navigator.canShare({ files: [new File([pdfBlob], 'relatorio_ocorrencia.pdf', { type: 'application/pdf' })] })) {
      const file = new File([pdfBlob], 'relatorio_ocorrencia.pdf', { type: 'application/pdf' });
      try {
        await navigator.share({
          files: [file],
          title: 'Relatório de Atendimento',
          text: 'Segue o Relatório de Atendimento de Ocorrência.'
        });
      } catch (err) {
        alert('Compartilhamento cancelado ou não suportado.');
      }
    } else {
      alert('Seu dispositivo não suporta o compartilhamento de arquivos.');
    }
  }
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js')
      .then(() => console.log('Service Worker registrado com sucesso'))
      .catch(error => console.log('Erro ao registrar o Service Worker:', error));
  }

</script>

</script>

</body>
</html>
